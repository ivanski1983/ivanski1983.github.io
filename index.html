<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>iPhone SE Camera Test 2</title>
<style>
 body{font-family:system-ui,sans-serif;margin:16px}
 video{width:100%;max-width:520px;background:#000;border-radius:12px}
 button{padding:10px 14px;border:1px solid #ddd;border-radius:10px;margin-right:8px}
 pre{white-space:pre-wrap;background:#f6f6f6;padding:8px;border-radius:8px}
</style>
</head>
<body>
<h1>iPhone SE Camera Test</h1>
<video id="vid" playsinline muted></video><br/>
<button id="start">Start</button>
<button id="stop" disabled>Stop</button>
<pre id="log">Log…</pre>

<script>
const v = document.getElementById('vid');
const log = (m)=>{ document.getElementById('log').textContent = String(m); };
let stream;

function info(){
  const t = stream?.getVideoTracks?.()[0];
  const s = t?.getSettings?.() || {};
  log(
    'readyState: '+v.readyState+'\n' +
    'paused: '+v.paused+'\n' +
    'track label: '+(t?.label || '(none)')+'\n' +
    'settings: '+JSON.stringify(s, null, 2)
  );
}

async function start(){
  document.getElementById('start').disabled = true;
  document.getElementById('stop').disabled = false;
  try {
    // Narrower constraints help older/SE devices
    stream = await navigator.mediaDevices.getUserMedia({
      video: {
        facingMode: { ideal: 'environment' },
        width:  { ideal: 640,  max: 1280 },
        height: { ideal: 480,  max: 720  },
        focusMode: 'continuous' // harmless if unsupported
      },
      audio: false
    });
  } catch(e){
    log('getUserMedia failed:\n' + e + '\n\nChecklist:\n• Use HTTPS (GitHub Pages)\n• Safari Camera: Allow\n• Not inside GitHub app viewer\n• Close other camera apps');
    document.getElementById('start').disabled = false;
    document.getElementById('stop').disabled = true;
    return;
  }

  v.srcObject = stream;

  v.onloadedmetadata = async ()=>{
    try { await v.play(); } catch(e){ log('video.play() error:\n'+e); }
    info();
  };

  v.onplaying = ()=> info();
  v.onpause = ()=> log('Video paused'); 
  v.onerror = (e)=> log('Video error: ' + JSON.stringify(e, null, 2));
}

function stop(){
  try { stream?.getTracks?.().forEach(t=>t.stop()); } catch{}
  v.srcObject = null;
  document.getElementById('start').disabled = false;
  document.getElementById('stop').disabled = true;
  log('Stopped');
}

document.getElementById('start').addEventListener('click', start);
document.getElementById('stop').addEventListener('click', stop);
</script>
</body>
</html>


