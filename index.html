<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Camera Test (Back Camera)</title>
<style>
  body{font-family:system-ui,sans-serif;margin:16px}
  video{width:100%;max-width:520px;background:#000;border-radius:12px}
  .row{display:flex;gap:8px;margin:12px 0}
  button{padding:10px 14px;border:1px solid #ddd;border-radius:10px}
  #log{white-space:pre-wrap;color:#b00020;margin-top:8px}
</style>
</head>
<body>
<h1>Camera Test (Back Camera)</h1>
<video id="v" playsinline muted></video>
<div class="row">
  <button id="start">Start</button>
  <button id="stop" disabled>Stop</button>
</div>
<pre id="log"></pre>

<script>
const v = document.getElementById('v');
const log = (msg)=>{ document.getElementById('log').textContent = String(msg); };

let stream;

async function start() {
  document.getElementById('start').disabled = true;
  document.getElementById('stop').disabled = false;
  log('');

  try {
    // Ask for rear camera first
    stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: { ideal: 'environment' }, width:{ideal:1280}, height:{ideal:720} },
      audio: false
    });
  } catch(e1) {
    // Fallback: any camera
    log('Rear camera failed, trying default...\n' + e1);
    try {
      stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
    } catch(e2) {
      log('Could not start camera.\n' + e2 + '\n\nChecklist:\n• Use HTTPS\n• Safari > Settings > Camera > Allow\n• Close other camera apps\n• If managed device, camera may be restricted');
      document.getElementById('start').disabled = false;
      document.getElementById('stop').disabled = true;
      return;
    }
  }

  try {
    v.srcObject = stream;
    await v.play(); // <-- IMPORTANT on iOS
  } catch (e3) {
    log('Video play() failed:\n' + e3);
  }

  // Show actual track info
  const track = stream.getVideoTracks()[0];
  log('Camera started:\n' + (track && track.label ? track.label : '(no label)'));
}

function stop() {
  if (stream) stream.getTracks().forEach(t=>t.stop());
  v.srcObject = null;
  document.getElementById('start').disabled = false;
  document.getElementById('stop').disabled = true;
}

document.getElementById('start').addEventListener('click', start);
document.getElementById('stop').addEventListener('click', stop);
</script>
</body>
</html>
